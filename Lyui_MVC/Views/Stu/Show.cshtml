
@{
    Layout = null;
}

<!DOCTYPE html>


<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Show</title>
    <script src="~/Scripts/jquery-3.5.0.js"></script>
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/layui/layui.js"></script>
</head>
<body>
    <form class="layui-form">

        @*<div style="display: none" id="adddiv">
                <div class="layui-form-item">
                    <label class="layui-form-label">学生姓名</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" lay-verify="required" lay-reqtext="学生姓名是必填项，岂能为空？" autocomplete="off" placeholder="请输入学生姓名" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">性别</label>
                        <div class="layui-input-block">
                            <input type="radio" name="sex" value="true" title="男" checked="">
                            <input type="radio" name="sex" value="false" title="女">
                        </div>

                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">教室</label>
                        <div class="layui-input-inline">
                            <select name="cId" id="class" lay-search="">
                                <option value="">直接选择或搜索选择</option>

                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>

            </div>*@
        <div style="display: none" id="adddiv">
            <div class="layui-form-item">
                <label class="layui-form-label">车辆姓名</label>
                <div class="layui-input-block">
                    <input type="text" name="vName" lay-verify="required" lay-reqtext="车辆姓名是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆姓名" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">车队名称</label>
                <div class="layui-input-inline">
                    <select name="mid" id="class" lay-search="">
                        <option value="">直接选择或搜索选择</option>

                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">车牌号</label>
                <div class="layui-input-block">
                    <input type="text" name="vLicense" lay-verify="required" lay-reqtext="车牌号是必填项，岂能为空？" autocomplete="off" placeholder="请输入车牌号" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆价格</label>
                <div class="layui-input-block">
                    <input type="text" name="vehiclePrices" lay-verify="required" lay-reqtext="车辆价格是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆价格" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车身颜色</label>
                <div class="layui-input-block">
                    <input type="text" name="vcolor" lay-verify="required" lay-reqtext="车身颜色是必填项，岂能为空？" autocomplete="off" placeholder="请输入车身颜色" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆燃料</label>
                <div class="layui-input-block">
                    <input type="text" name="vehicleFuel" lay-verify="required" lay-reqtext="车辆燃料是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆燃料" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排放等级</label>
                <div class="layui-input-block">
                    <input type="text" name="emission" lay-verify="required" lay-reqtext="排放等级是必填项，岂能为空？" autocomplete="off" placeholder="请输入排放等级" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆结构</label>
                <div class="layui-input-block">
                    <input type="text" name="vehicleStructure" lay-verify="required" lay-reqtext="车辆结构是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆结构" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

        </div>
    </form>
    <form class="layui-form" lay-filter="example">
        @*<div style="display: none" id="editdiv">
                <div class="layui-form-item">
                    <label class="layui-form-label">学生姓名</label>
                    <div class="layui-input-block">
                        <input type="hidden" name="sId"/>
                        <input type="text" name="name" lay-verify="required" lay-reqtext="学生姓名是必填项，岂能为空？" autocomplete="off" placeholder="请输入学生姓名" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">性别</label>
                        <div class="layui-input-block">
                            <input type="radio" name="sex" value="true" id="nan" title="男" checked="">
                            <input type="radio" name="sex" value="false" id="nv" title="女">
                        </div>

                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">教室</label>
                        <div class="layui-input-inline">
                            <select name="cId" id="fclass" lay-search="">
                                <option value="">直接选择或搜索选择</option>

                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="edit">修改</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>

            </div>*@
        <div style="display: none" id="editdiv">

            <div class="layui-inline">
                <label class="layui-form-label">车队名称</label>
                <div class="layui-input-inline">
                    <select name="mid" id="fclass" lay-search="">
                        <option value="">直接选择或搜索选择</option>

                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆姓名</label>
                <div class="layui-input-block">
                    <input type="hidden" name="vid" />
                    <input type="text" name="vName" lay-verify="required" lay-reqtext="车辆姓名是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆姓名" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">车牌号</label>
                <div class="layui-input-block">
                    <input type="text" name="vLicense" lay-verify="required" lay-reqtext="车牌号是必填项，岂能为空？" autocomplete="off" placeholder="请输入车牌号" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆价格</label>
                <div class="layui-input-block">
                    <input type="text" name="vehiclePrices" lay-verify="required" lay-reqtext="车辆价格是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆价格" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车身颜色</label>
                <div class="layui-input-block">
                    <input type="text" name="vcolor" lay-verify="required" lay-reqtext="车身颜色是必填项，岂能为空？" autocomplete="off" placeholder="请输入车身颜色" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆燃料</label>
                <div class="layui-input-block">
                    <input type="text" name="vehicleFuel" lay-verify="required" lay-reqtext="车辆燃料是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆燃料" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排放等级</label>
                <div class="layui-input-block">
                    <input type="text" name="emission" lay-verify="required" lay-reqtext="排放等级是必填项，岂能为空？" autocomplete="off" placeholder="请输入排放等级" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">车辆结构</label>
                <div class="layui-input-block">
                    <input type="text" name="vehicleStructure" lay-verify="required" lay-reqtext="车辆结构是必填项，岂能为空？" autocomplete="off" placeholder="请输入车辆结构" class="layui-input">
                </div>
            </div>
            

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="edit">修改</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

        </div>
    </form>
    @*<div class="demoTable">
            搜索姓名：
            <div class="layui-inline">
                <input class="layui-input" name="name" id="name" autocomplete="off">
            </div>
            教室:
            <div class="layui-input-inline layui-form">
                <select name="cId" id="cId" lay-search="">
                    <option value="0">直接选择或搜索选择</option>

                </select>
            </div>
            <button id="searchBtn" class="layui-btn" data-type="reload"><i class="layui-icon">&#xe615;</i>搜索</button>
            <button id="addBtn" class="layui-btn" data-type="reload"><i class="layui-icon">&#xe608;</i>添加</button>
        </div>*@
    <div class="demoTable">
        搜索姓名：
        <div class="layui-inline">
            <input class="layui-input" name="vName" id="vName" autocomplete="off">
        </div>
        教室:
        <div class="layui-input-inline layui-form">
            <select name="mid" id="mid" lay-search="">
                <option value="0">直接选择或搜索选择</option>

            </select>
        </div>
        <button id="searchBtn" class="layui-btn" data-type="reload"><i class="layui-icon">&#xe615;</i>搜索</button>
        <button id="addBtn" class="layui-btn" data-type="reload"><i class="layui-icon">&#xe608;</i>添加</button>
    </div>
    <table id="idTest" lay-filter="demo"></table>
    <script type="text/html" id="barDemo">

        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>

        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        @*<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>*@
    </script>
    @*判断性别*@
    <script type="text/html" id="sex">
        {{#  if(d.sex== true){ }}
        男
        {{#  } else if(d.sex== false) { }}
        女
        {{#  } }}
        @*<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>*@

    </script>
    <script type="text/javascript">

        $(function () {
            GetClass();
        })
        //绑定下拉
        function GetClass() {
            $.ajax({
                url: "http://localhost:9690/api/stu/GetClass",
                dataType: "json",
                type: "get",
                success: function (data) {
                    console.log(data);
                    $(data).each(function () {
                        $("#mid").append('<option value="' + this.mid + '">' + this.mName + '</option>');
                        $("#class").append('<option value="' + this.mid + '">' + this.mName + '</option>');
                        $("#fclass").append('<option value="' + this.mid + '">' + this.mName + '</option>');

                        //$("#cId").append('<option value="' + this.cId + '">' + this.cName + '</option>');
                        //$("#class").append('<option value="' + this.cId + '">' + this.cName + '</option>');
                        //$("#fclass").append('<option value="' + this.cId + '">' + this.cName + '</option>');
                    });
                }
            });

        }
        layui.use(['table', 'form', 'jquery', 'element', 'layer'], function () {
            var table = layui.table;
            var form = layui.form;
            var element = layui.element;
            var layer = layui.layer;
            var laydate = layui.laydate;
            form.render('select');
            table.render({
                elem: '#idTest',
                url: 'http://localhost:9690/api/Stu/GetStu',
                cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                , 
                title: '学生信息',
                page: true //是否显示分页
                ,
                limit: 2 //每页默认显示的数量
                , limits: [10, 20, 30, 40, 50]
                , method: 'get'
                , cols: [
                    [
                        //{ field: 'vid', title: '车辆编号', align: 'center' },
                        { field: 'mName', title: '车队名称', align: 'center' },
                        { field: 'vName', title: '车辆姓名', align: 'center' },
                        { field: 'vLicense', title: '车牌号', align: 'center' },
                        { field: 'vehiclePrices', title: '车辆价格', align: 'center' },
                        { field: 'vcolor', title: '车身颜色', align: 'center' },
                        { field: 'vehicleFuel', title: '车辆燃料', align: 'center' },
                        { field: 'emission', title: '排放等级', align: 'center' },
                        { field: 'vehicleStructure', title: '车辆结构', align: 'center' },
                        { fixed: 'right', title: '操作', width: 250, align: 'center', toolbar: '#barDemo' }

                        //{ field: 'sId', title: '编号', align: 'center' },
                        //{ field: 'name', title: '姓名', align: 'center' },
                        //{ field: 'sex', title: '性别', align: 'center', hide: true },
                        //{ title: '性别', align: 'center', toolbar: '#sex' },
                        //{ field: 'cId', title: '教室外键', align: 'center', hide: true },
                        //{ field: 'cName', title: '教室', align: 'center' },
                        //{ fixed: 'right', title: '操作', width: 250, align: 'center', toolbar: '#barDemo' }
                    ]
                ],
                id: 'idTest'

            });
            //搜索
            $("#searchBtn").on('click', function () {
                var mid = $("#mid");
                var vName = $("#vName");

                //var cId = $("#cId");
                //var name = $("#name");
                form.render('select');
                //执行重载
                table.reload('idTest', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        vName: vName.val(),
                        mid: parseInt(mid.val())

                        //name: name.val(),
                        //cId: parseInt(cId.val())

                    }
                });
            });
            //添加窗口
            $("#addBtn").click(function () {
                //页面层
                layer.open({
                    type: 1,
                    title: "新增页面",
                    area: ['500px', '500px'], //宽高
                    content: $("#adddiv"),
                    maxmin: true
                });
                form.render('select');
            });
            //添加
            form.on('submit(add)',
                function (data) {
                    //layer.msg(JSON.stringify(data.field));
                    //int和bool得转换格式
                    var obj = {};
                    obj.vName = data.field.vName;
                    obj.mid = parseInt(data.field.mid);
                    obj.vLicense = data.field.vLicense;
                    obj.vehiclePrices = data.field.vehiclePrices;
                    obj.vcolor = data.field.vcolor;
                    obj.vehicleFuel = data.field.vehicleFuel;
                    obj.emission = data.field.emission;
                    obj.vehicleStructure = data.field.vehicleStructure;
                    //obj.name = data.field.name;
                    //obj.sex = data.field.sex == "false" ? false : true;
                    //obj.cId = parseInt(data.field.cId);
                    console.log(obj);
                    $.ajax({
                        url: "http://localhost:9690/api/stu/AddStu",
                        dataType: "json",
                        type: "post",
                        data: JSON.stringify(obj),
                        contentType: "application/json",
                        success: function (data) {
                            if (data > 0) {
                                layer.alert('添加成功',
                                    {
                                        icon: 6,
                                        yes: function (index) {
                                            layer.close(index);
                                            location.reload();
                                        }
                                    });

                            } else {
                                layer.alert('添加失败', { icon: 5 });
                            }

                        }

                    });
                    return false;
                });
            //修改
            form.on('submit(edit)', function (data) {
                //layer.msg(JSON.stringify(data.field));
                //int和bool得转换格式
                var obj = {};
                obj.vid = parseInt(data.field.vid);
                obj.mid = parseInt(data.field.mid);
                obj.vName = data.field.vName;
                obj.vLicense = data.field.vLicense;
                obj.vehiclePrices = data.field.vehiclePrices;
                obj.vcolor = data.field.vcolor;
                obj.vehicleFuel = data.field.vehicleFuel;
                obj.emission = data.field.emission;
                obj.vehicleStructure = data.field.vehicleStructure;
                //obj.sId = parseInt(data.field.sId);
                //obj.name = data.field.name;
                //obj.sex = data.field.sex == "false" ? false : true;
                //obj.cId = parseInt(data.field.cId);
                $.ajax({
                    url: "http://localhost:9690/api/stu/EditStu",
                    dataType: "json",
                    type: "post",
                    contentType: "application/json",
                    data: JSON.stringify(obj),
                    success: function (data) {
                        if (data > 0) {
                            layer.alert('修改成功',
                                {
                                    icon: 6,
                                    yes: function (index) {
                                        layer.close(index);
                                        location.reload();
                                    }
                                });

                        } else {
                            layer.alert('修改失败', { icon: 5 });
                        }

                    }

                });
                return false;
            });
            //监听工具条
            table.on('tool(demo)',
                function (obj) {
                    var data = obj.data;
                    if (obj.event === 'detail') {
                        layer.msg('ID：' + data.pcId + ' 的查看操作');
                    } else if (obj.event === 'del') {
                        layer.confirm('真的删除行么',
                            function (index) {
                                layer.close(index);
                                //layer.alert('编辑行：<br>' + JSON.stringify(data));
                                var a = {};
                                a.vid = parseInt(data.vid);
                                a.vName = data.vName;
                                a.vLicense = data.vLicense;
                                a.vehiclePrices = data.vehiclePrices;
                                a.vcolor = data.vcolor;
                                a.vehicleFuel = data.vehicleFuel;
                                a.emission = data.emission;
                                a.vehicle = data.vehicle;
                                a.mid = parseInt(data.mid);
                                //a.sId = parseInt(data.sId);
                                //a.name = data.name;
                                //a.sex = data.sex == "false" ? false : true;
                                //a.cId = parseInt(data.cId);
                                $.ajax({
                                    url: "http://localhost:9690/api/stu/DelStu",
                                    dataType: "json",
                                    type: "post",
                                    data: JSON.stringify(a),
                                    contentType: "application/json",
                                    success: function (data) {
                                        if (data > 0) {
                                            layer.alert('已删除',
                                                {
                                                    icon: 6,
                                                    yes: function (index) {
                                                        layer.close(index);
                                                        obj.del();
                                                    }
                                                });

                                        }
                                        else {
                                            layer.msg("删除失败", { icon: 5 });
                                        }

                                    }

                                });
                            });
                    } else if (obj.event === 'edit') {
                        //layer.alert('编辑行：<br>' + JSON.stringify(data));
                        //页面层
                        layer.open({
                            type: 1,
                            maxmin: true,
                            title: "修改",
                            area: ['500px', '500px'], //宽高
                            content: $("#editdiv")
                        });
                        //重新渲染下拉
                        form.render('select');

                        //反填
                        form.val('example',
                            {
                                "vid": data.vid,
                                "mid": data.mid,
                                "vName": data.vName,
                                "vLicense": data.vName,
                                "vehiclePrices": data.vehiclePrices,
                                "vcolor": data.vcolor,
                                "vehicleFuel": data.vehicleFuel,
                                "emission": data.emission,
                                "vehicleStructure": data.vehicleStructure

                                //"sId": data.sId,
                                //"name": data.name,
                                //"cId": data.cId,// "name": "value"
                                //"sex": ""+data.sex+""
                            });
                        //data.sex == true ? $("#nan").prop("checked", "checked") : $("#nv").prop("checked", "checked");
                    }
                });

        });
    </script>
</body>
</html>
